<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Publications · Oishy Saha</title>
  <meta name="description" content="Publications of Oishy Saha" />
  <link rel="icon" href="favicon.ico" />
  <style>
    :root{
      --bg:#0b0f19;--text:#e8ecf3;--muted:#a9b2c7;--link:#7bdcff;--card:#11182a;--border:rgba(255,255,255,.08);
      --radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35);--max:980px
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(900px 600px at -10% -20%,#1a2650 0%,var(--bg) 55%),var(--bg);color:var(--text);font:16px/1.65 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
    a{color:var(--link);text-decoration:none}
    a:hover{text-decoration:underline}
    .shell{max-width:var(--max);margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .back{display:inline-flex;gap:8px;align-items:center}
    main{display:flex;flex-direction:column;gap:20px}
    section{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    h1{margin:0;font-size:26px}
    h2{margin:0 0 12px;font-size:20px}

    .pubs {display:flex; flex-direction:column; gap:16px}
    .pub-item{
      display:grid; grid-template-columns:86px 1fr;
      gap:16px; background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:16px; box-shadow:var(--shadow);
    }
    .pub-badge{
      height:28px; display:inline-flex; align-items:center; justify-content:center;
      padding:0 10px; border-radius:8px; font-size:12px; font-weight:800; letter-spacing:.02em; color:#111;
      margin-top:2px;
    }
    .pub-badge.acl{background:#ffb37a}
    .pub-badge.arxiv{background:#bdbdbd}
    .pub-badge.ieee{background:#7bdcff}
    .pub-badge.conf{background:#a7e3a7}
    .pub-main h3{margin:0 0 6px; font-size:22px; line-height:1.25}
    .pub-main h3 a{color:var(--text)}
    .pub-authors{margin:0; color:var(--muted)}
    .pub-venue{margin:6px 0 10px; color:var(--muted); font-size:14px}
    .pub-actions{display:flex; flex-wrap:wrap; gap:8px}
    .pub-btn{
      display:inline-flex; align-items:center; height:28px; padding:0 10px;
      border:1px solid var(--border); border-radius:6px; background:rgba(255,255,255,.05);
      font-weight:700; font-size:12px; letter-spacing:.02em;
    }
    .pub-btn:hover{background:rgba(255,255,255,.09); text-decoration:none}
    .pub-box{margin-top:10px; border:1px dashed var(--border); border-radius:10px; padding:10px; background:rgba(255,255,255,.03)}
    .pub-box.hidden{display:none}
    pre.bib{white-space:pre-wrap; word-break:break-word; background:rgba(0,0,0,.25); padding:8px; border-radius:8px; margin:6px 0 0}
    .pub-copy{margin-top:6px; display:flex; justify-content:flex-end}

    footer{color:var(--muted);text-align:center;margin-top:12px}
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <h1>Publications</h1>
      <a class="back" href="index.html" rel="noopener">← Back to Home</a>
    </header>

    <main>
      <section>
        <h2>All Publications</h2>
        <div id="pub-list" class="pubs">Loading…</div>
      </section>

      <footer>
        © <span id="year"></span> Oishy Saha
      </footer>
    </main>
  </div>

  <!-- Optional inline fallback: paste your array here to render without fetch -->
  <script type="application/json" id="pub-data">[]</script>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const E = s => String(s||'')
      .replaceAll('&','&amp;').replaceAll('<','&lt;')
      .replaceAll('>','&gt;').replaceAll('"','&quot;')
      .replaceAll("'","&#039;");

    function renderPubItem(p){
      const idAbs=`abs-${p.id}`, idBib=`bib-${p.id}`;
      const has = k => p.links && p.links[k] && p.links[k].trim();
      const authors = (p.authors||[]).join(', ');
      const venueLine = [p.venue, p.year].filter(Boolean).join(', ');
      const doiBtn = p.doi ? `<a class="pub-btn" href="https://doi.org/${p.doi}" target="_blank" rel="noopener">DOI</a>` : '';
      return `
        <article class="pub-item" id="paper-${E(p.id)}">
          <div>${p.badge ? `<span class="pub-badge ${E((p.badgeClass||'').toLowerCase())}">${E(p.badge)}</span>` : ''}</div>
          <div class="pub-main">
            <h3>${p.title ? `<a href="${has('html') ? p.links.html : '#'}" target="_blank" rel="noopener">${E(p.title)}</a>` : ''}</h3>
            <p class="pub-authors">${E(authors)}</p>
            <div class="pub-venue">${E(venueLine)}</div>
            <div class="pub-actions">
              ${p.abstract ? `<a class="pub-btn" data-action="toggle" data-target="${idAbs}" href="#">ABS</a>` : ''}
              ${p.bibtex ? `<a class="pub-btn" data-action="toggle" data-target="${idBib}" href="#">BIB</a>` : ''}
              ${has('html') ? `<a class="pub-btn" href="${p.links.html}" target="_blank" rel="noopener">HTML</a>` : ''}
              ${has('pdf')  ? `<a class="pub-btn" href="${p.links.pdf}" target="_blank" rel="noopener">PDF</a>` : ''}
              ${has('code') ? `<a class="pub-btn" href="${p.links.code}" target="_blank" rel="noopener">CODE</a>` : ''}
              ${doiBtn}
            </div>
            ${p.abstract ? `<div id="${idAbs}" class="pub-box hidden"><strong>Abstract.</strong><p>${E(p.abstract)}</p></div>` : ''}
            ${p.bibtex ? `<div id="${idBib}" class="pub-box hidden"><strong>BibTeX.</strong><pre id="pre-${idBib}" class="bib">${E(p.bibtex)}</pre><div class="pub-copy"><a class="pub-btn" data-action="copy" data-target="pre-${idBib}" href="#">Copy</a></div></div>` : ''}
          </div>
        </article>`;
    }

    async function loadPublications(){
      const container = document.getElementById('pub-list');

      // Inline fallback first
      try{
        const inline = document.getElementById('pub-data');
        if (inline && inline.textContent.trim() && inline.textContent.trim() !== '[]') {
          const items = JSON.parse(inline.textContent);
          if (Array.isArray(items) && items.length){
            items.sort((a,b)=>{
              const da = a.date ? new Date(a.date) : new Date(String(a.year||0));
              const db = b.date ? new Date(b.date) : new Date(String(b.year||0));
              return db - da;
            });
            container.innerHTML = items.map(renderPubItem).join('');
            return;
          }
        }
      }catch(e){ console.warn('Inline pub-data parse failed:', e); }

      // Fetch publications.json with cache-busting
      async function get(url){
        const res = await fetch(url + (url.includes('?') ? '&' : '?') + 't=' + Date.now(), { cache: 'no-store' });
        if(!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('publications.json must be a JSON array');
        return data;
      }

      try{
        const items = await get('./publications.json');
        items.sort((a,b)=>{
          const da = a.date ? new Date(a.date) : new Date(String(a.year||0));
          const db = b.date ? new Date(b.date) : new Date(String(b.year||0));
          return db - da;
        });
        container.innerHTML = items.map(renderPubItem).join('');
      }catch(err){
        console.error('Publications load error:', err);
        container.innerHTML = `<p style="color:#b00">Failed to load publications: ${String(err.message||err)}</p>`;
      }
    }

    document.addEventListener('click', e=>{
      const a = e.target.closest('a.pub-btn'); if(!a) return;
      const action = a.dataset.action, target = a.dataset.target;
      if(action === 'toggle'){ e.preventDefault(); const box = document.getElementById(target); if(box) box.classList.toggle('hidden'); }
      if(action === 'copy'){ e.preventDefault(); const pre = document.getElementById(target); if(pre){ navigator.clipboard.writeText(pre.textContent.trim()).then(()=>{ a.textContent='Copied!'; setTimeout(()=>a.textContent='Copy',1000); }).catch(()=> alert('Copy failed.')); } }
    });

    loadPublications();
  </script>
</body>
</html>
